{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/alex/workspace/app-agent/ui/src/app/components/ChatInterface.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, FormEvent } from 'react';\nimport { WsMessage } from '@common/ws_messages';\n\n// A simple message type for our local state\ninterface DisplayMessage {\n  source: 'user' | 'agent' | 'system' | 'tool';\n  content: string;\n  type: 'text' | 'tool_call' | 'tool_result' | 'error';\n}\n\nexport default function ChatInterface() {\n  const [socket, setSocket] = useState<WebSocket | null>(null);\n  const [input, setInput] = useState('');\n  const [messages, setMessages] = useState<DisplayMessage[]>([]);\n  const [isConnected, setIsConnected] = useState(false);\n\n  useEffect(() => {\n    // Assuming the gateway runs on port 8001\n    const ws = new WebSocket('ws://localhost:8001/api/agent');\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      setIsConnected(true);\n      setMessages([{ source: 'system', content: 'Connected to agent.', type: 'text' }]);\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const message: WsMessage = JSON.parse(event.data);\n        handleIncomingMessage(message);\n      } catch (error) {\n        console.error('Failed to parse incoming message:', event.data);\n        setMessages(prev => [...prev, { source: 'system', content: 'Received malformed message.', type: 'error' }]);\n      }\n    };\n\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      setIsConnected(false);\n      setMessages(prev => [...prev, { source: 'system', content: 'Connection lost.', type: 'error' }]);\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n      setMessages(prev => [...prev, { source: 'system', content: 'Connection error.', type: 'error' }]);\n    };\n\n    setSocket(ws);\n\n    // Clean up the connection when the component unmounts\n    return () => {\n      ws.close();\n    };\n  }, []);\n\n  const handleIncomingMessage = (msg: WsMessage) => {\n    let displayMsg: DisplayMessage | null = null;\n    switch (msg.t) {\n      case 'tok':\n        // Append token to the last message if it's from the agent\n        setMessages(prev => {\n          const lastMsg = prev[prev.length - 1];\n          if (lastMsg && lastMsg.source === 'agent') {\n            return [...prev.slice(0, -1), { ...lastMsg, content: lastMsg.content + msg.d }];\n          }\n          return [...prev, { source: 'agent', content: msg.d, type: 'text' }];\n        });\n        break;\n      case 'agent_response':\n        displayMsg = { source: 'agent', content: msg.d, type: 'text' };\n        break;\n      case 'tool_call':\n        displayMsg = { source: 'tool', content: `Calling: ${msg.d.name}(${JSON.stringify(msg.d.args)})`, type: 'tool_call' };\n        break;\n      case 'tool_result':\n        displayMsg = { source: 'tool', content: `Result from ${msg.d.tool_name}: ${JSON.stringify(msg.d.result)}`, type: 'tool_result' };\n        break;\n      case 'final':\n        displayMsg = { source: 'agent', content: msg.d, type: 'text' };\n        break;\n      case 'error':\n        displayMsg = { source: 'system', content: msg.d, type: 'error' };\n        break;\n    }\n    if (displayMsg) {\n      setMessages(prev => [...prev, displayMsg]);\n    }\n  };\n\n  const handleSubmit = (e: FormEvent) => {\n    e.preventDefault();\n    if (input.trim() && socket && isConnected) {\n      const messageToSend = { prompt: input };\n      socket.send(JSON.stringify(messageToSend));\n      setMessages(prev => [...prev, { source: 'user', content: input, type: 'text' }]);\n      setInput('');\n    }\n  };\n\n  const getMessageStyle = (source: DisplayMessage['source']) => {\n    switch (source) {\n      case 'user': return 'bg-blue-100 dark:bg-blue-900 self-end';\n      case 'agent': return 'bg-gray-200 dark:bg-gray-700 self-start';\n      case 'tool': return 'bg-yellow-100 dark:bg-yellow-800 text-xs italic self-start';\n      case 'system': return 'bg-red-100 dark:bg-red-900 text-xs text-center self-center';\n      default: return 'bg-white dark:bg-gray-800';\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col w-1/3 max-w-md border-r border-gray-200 dark:border-gray-800 h-full\">\n      <div className=\"flex-1 p-4 overflow-y-auto flex flex-col gap-3\">\n        {messages.map((msg, index) => (\n          <div key={index} className={`p-2 rounded-lg max-w-xs ${getMessageStyle(msg.source)}`}>\n            <p className=\"whitespace-pre-wrap\">{msg.content}</p>\n          </div>\n        ))}\n      </div>\n      <div className=\"p-4 border-t border-gray-200 dark:border-gray-800\">\n        <form className=\"flex gap-2\" onSubmit={handleSubmit}>\n          <input\n            type=\"text\"\n            placeholder={isConnected ? 'Type your message...' : 'Connecting...'}\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            className=\"flex-1 p-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white\"\n            disabled={!isConnected}\n          />\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-500\"\n            disabled={!isConnected}\n          >\n            Send\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///Users/alex/workspace/app-agent/ui/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":";AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,uBAA2B,EAAF;;IAczC,OAAO;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;YAEP;QACF,OAAO;;QAMP;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 287, "column": 0}, "map": {"version":3,"sources":["file:///Users/alex/workspace/app-agent/ui/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,4HAAyBC,QAAQ,CACxD,YACD,CAACC,kBAAkB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///Users/alex/workspace/app-agent/ui/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored['react-ssr'].React\n"],"names":["module","exports","require","vendored","React"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,4HAAyBC,QAAQ,CAAC,YAAY,CAACC,KAAK","ignoreList":[0],"debugId":null}}]
}